<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/10/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/10/"/>

  <title> Hexo </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hexo</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/25/数据结构-AVL树/" itemprop="url">
                  数据结构（五）-- AVL 树
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-10-25T20:01:10+08:00" content="2014-10-25">
              2014-10-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="AVL-树"><a href="#AVL-树" class="headerlink" title="AVL 树"></a>AVL 树</h2><p>　　AVL 是平衡树的一种，它保证<strong>每个</strong>节点的左子树高度和右子树高度最多相差 1。空节点的高度为 0，AVL 树能保证 N 个节点的树的高度为 logN。</p>
<p>　　好了，我们让 AVL 树的节点都记录它的高度：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> node;</div><div class="line"><span class="keyword">using</span>  node_ptr  = node *;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> node</div><div class="line">&#123;</div><div class="line">    node( <span class="keyword">const</span> T &amp;v, node_ptr l = <span class="literal">nullptr</span>, node_ptr r = <span class="literal">nullptr</span>, size_type h = <span class="number">1</span> )</div><div class="line">        : value( v ), left( l ), right( r ), height( h )</div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    T           value;</div><div class="line">    node_ptr    left;</div><div class="line">    node_ptr    right;</div><div class="line">    size_type   height;             <span class="comment">// 高度</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// height() 用来得到节点的高度</span></div><div class="line"><span class="function">size_type <span class="title">height</span><span class="params">( node_ptr ptr )</span> <span class="keyword">const</span> </span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> ptr ? ptr-&gt;height : <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="单旋转"><a href="#单旋转" class="headerlink" title="单旋转"></a>单旋转</h2><p>　　向 AVL 树中插入节点可能会导致 AVL 失衡。</p>
<p>　　先看看第一种可能会使 AVL 树失衡的情况，假定 k2 是根节点，我们插入的节点使得 X 的高度加 1，现在 k2 失衡，因为此时 k1 ( k2 的左子树 ) 的高度是 3，而 Z ( k2 的右子树) 的高度是 1，二者差值大于 1。<br><img src="/images/data-structure/avl1.png" alt=""><br>　　为了平衡 k2，需要执行单旋转，也就是<strong>抬高 X</strong>，<strong>降低 Z</strong>：</p>
<ul>
<li>保存 k1，将 Y 作为 k2 的左子树。</li>
<li>将 k2 作为 k1 的右子树</li>
<li>将这棵子树的根换成 k1。</li>
</ul>
<p><img src="/images/data-structure/avl2.png" alt=""><br>　　旋转过后，k1 和 k2 的高度发生了变化，所以要重新设置它们的高度：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">single_rotate_left_child</span><span class="params">( node_ptr &amp;k2 )</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">auto</span> k1 = k2-&gt;left;       <span class="comment">// 得到 k1</span></div><div class="line">    k2-&gt;left = k1-&gt;right;     <span class="comment">// 让 Y 成为 k2 的左子树</span></div><div class="line">    k1-&gt;right = k2;           <span class="comment">// 让 k2 成为 k1 的左子树</span></div><div class="line">    </div><div class="line">    k2-&gt;height = <span class="built_in">std</span>::max( height( k2-&gt;left ), height( k2-&gt;right ) ) + <span class="number">1</span>;   <span class="comment">// 设置 k2 的高度</span></div><div class="line">    k1-&gt;height = <span class="built_in">std</span>::max( height( k1-&gt;left ), height( k1-&gt;right ) ) + <span class="number">1</span>;   <span class="comment">// 设置 k1 的高度</span></div><div class="line">    k2 = k1;                  <span class="comment">// 现在 k1 坐上了 k2 的位置</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>　　看看第二种会使 AVL 树失衡的情况，我们插入的节点使得 Z 的高度增加 1，这时 k1 失衡：<br><img src="/images/data-structure/avl3.png" alt=""><br>　　为了平衡 k1，执行一次单旋转：</p>
<ul>
<li>保存 k2，将 Y 作为 k1 的右子树。</li>
<li>将 k1 作为 k2 的左子树。</li>
<li>将这棵子树的根换成 k2。</li>
</ul>
<p><img src="/images/data-structure/avl4.png" alt=""><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">single_rotate_right_child</span><span class="params">( node_ptr &amp;k1 )</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">auto</span> k2 = k1-&gt;right;     <span class="comment">// 得到 k2  </span></div><div class="line">    k1-&gt;right = k2-&gt;left;    <span class="comment">// 让 Y 成为 k1 的右子树</span></div><div class="line">    k2-&gt;left = k1;           <span class="comment">// 让 k1 成为 k2 的左子树 </span></div><div class="line">   </div><div class="line">    k2-&gt;height = <span class="built_in">std</span>::max( height( k2-&gt;left ), height( k2-&gt;right ) ) + <span class="number">1</span>;   <span class="comment">// 设置 k2 的高度</span></div><div class="line">    k1-&gt;height = <span class="built_in">std</span>::max( height( k1-&gt;left ), height( k1-&gt;right ) ) + <span class="number">1</span>;   <span class="comment">// 设置 k1 的高度</span></div><div class="line">    </div><div class="line">    k1 = k2;                 <span class="comment">// 将 k2 作为这颗子树的根。</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="双旋转"><a href="#双旋转" class="headerlink" title="双旋转"></a>双旋转</h2><p>　　单旋转并不总是适用的，例如，我们看看这里，我们将新的节点插入 k1 的右子树 Y 中，这使得 Y 的高度增加 1，k2 失衡：<br><img src="/images/data-structure/avl5.png" alt=""><br>　　执行一次单旋转并不能解决问题，因为 k2 还是失衡。</p>
<hr>
<p>　　看看这里：<br><img src="/images/data-structure/avl6.png" alt=""><br>　　既然一次单旋转不够用，那我们就执行两次单旋转：</p>
<ul>
<li>尽管 k1 不会失衡，我们还是要执行一次<code>single_rotate_right_child( k1 )</code>。<br><img src="/images/data-structure/avl7.png" alt=""></li>
<li>接下来执行一次<code>single_rotate_left_child( k3 )</code>。<br><img src="/images/data-structure/avl8.png" alt=""></li>
</ul>
<p>　　这时候树就是平衡的了，整个过程：<br><img src="/images/data-structure/avl9.png" alt=""><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">double_rotate_left_child</span><span class="params">( node_ptr &amp;k3 )</span></span></div><div class="line">&#123;</div><div class="line">    single_rotate_right_child( k3-&gt;left );</div><div class="line">    single_rotate_left_child( k3 );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>　　考虑最后一种情况，我们将新的节点插入到 Y，从而导致 k1 失衡：<br><img src="/images/data-structure/avl10.png" alt=""><br>　　这种情况和上面的情况类似：<br><img src="/images/data-structure/avl11.png" alt=""><br>　　执行两次单旋转：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">double_rotate_right_child</span><span class="params">( node_ptr &amp;k1 )</span></span></div><div class="line">&#123;</div><div class="line">    single_rotate_left_child( k1-&gt;right );</div><div class="line">    single_rotate_right_child( k1 );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="插入元素"><a href="#插入元素" class="headerlink" title="插入元素"></a>插入元素</h2><p>　　插入元素之后， AVL 树可能会变得不平衡：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">( <span class="keyword">const</span> T &amp;value )</span></span></div><div class="line">&#123;</div><div class="line">    insert( value, root_ );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">( <span class="keyword">const</span> T &amp;value, node_ptr &amp;ptr )</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>( !ptr )</div><div class="line">    &#123;</div><div class="line">        ptr = <span class="keyword">new</span> node( value );</div><div class="line">        ++size_;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>( value &lt; ptr-&gt;value ) </div><div class="line">    &#123;</div><div class="line">        insert( value, ptr-&gt;left );</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( value &gt; ptr-&gt;value ) </div><div class="line">    &#123;</div><div class="line">        insert( value, ptr-&gt;right );</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> </div><div class="line">    &#123;</div><div class="line">    &#125;        </div><div class="line"></div><div class="line">    balance( ptr );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　<code>blance()</code>用来保证树的平衡：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">balance</span><span class="params">( node_ptr &amp;ptr )</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>( !ptr ) </div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">           </div><div class="line">    <span class="keyword">if</span>( height( ptr-&gt;left ) &gt; height( ptr-&gt;right ) + <span class="number">1</span> ) </div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>( height( ptr-&gt;left-&gt;left ) &gt;= height( ptr-&gt;left-&gt;right ) ) </div><div class="line">        &#123;</div><div class="line">            <span class="comment">// 第一种情况，</span></div><div class="line">            single_rotate_left_child( ptr );</div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span> </div><div class="line">        &#123;</div><div class="line">            <span class="comment">// 第三种情况</span></div><div class="line">            double_rotate_left_child( ptr );</div><div class="line">        &#125;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( height( ptr-&gt;right ) &gt; height( ptr-&gt;left ) + <span class="number">1</span> ) </div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>( height( ptr-&gt;right-&gt;right ) &gt;= height( ptr-&gt;right-&gt;left ) ) </div><div class="line">        &#123;</div><div class="line">            <span class="comment">// 第二种情况</span></div><div class="line">            single_rotate_right_child( ptr );</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> </div><div class="line">        &#123;</div><div class="line">            <span class="comment">// 第四种情况</span></div><div class="line">            double_rotate_right_child( ptr );</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ptr-&gt;height = <span class="built_in">std</span>::max( height( ptr-&gt;left ), height( ptr-&gt;right ) ) + <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://www.amazon.com/Data-Structures-Algorithm-Analysis-C/dp/013284737X/ref=sr_1_4?s=books&amp;ie=UTF8&amp;qid=1422255950&amp;sr=1-4&amp;keywords=data+structure+and+algorithm+in+c%2B%2B" target="_blank" rel="external">Data Structures and Algorithm Analysis in C++ 4th Edition by Mark A. Weiss</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/22/数据结构-字典树/" itemprop="url">
                  数据结构（四）-- 字典树
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-10-22T20:01:10+08:00" content="2014-10-22">
              2014-10-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Trie-树"><a href="#Trie-树" class="headerlink" title="Trie 树"></a>Trie 树</h2><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">template &lt;typename T&gt;</div><div class="line">class TrieTree</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">    explicit TrieTree()</div><div class="line">        : root_( new node )</div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    ~TrieTree()</div><div class="line">    &#123;</div><div class="line">        clear();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    void clear()</div><div class="line">    &#123;</div><div class="line">        clear( root_ );</div><div class="line">        root_ = new node;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    TrieTree( const TrieTree &amp; ) = delete;</div><div class="line">    TrieTree &amp;operator=( const TrieTree &amp; ) = delete;</div><div class="line">    </div><div class="line">private:</div><div class="line">    struct node;</div><div class="line">    using  node_ptr  = node *;</div><div class="line">    using  value_ptr = T *;</div><div class="line">    </div><div class="line">    static constexpr int R = 128;</div><div class="line"> </div><div class="line">    node_ptr root_;</div><div class="line"></div><div class="line">    struct node</div><div class="line">    &#123;</div><div class="line">        explicit node()</div><div class="line">            : value( nullptr ), next( R, nullptr )</div><div class="line">        &#123;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        ~node()</div><div class="line">        &#123;</div><div class="line">            if( value )</div><div class="line">            &#123;</div><div class="line">                delete value;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        value_ptr              value;</div><div class="line">        std::vector&lt;node_ptr&gt;  next;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">public:</div><div class="line">    bool contains( const std::string &amp;key ) const </div><div class="line">    &#123;</div><div class="line">        return get( key ) != nullptr;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">private:</div><div class="line">    void clear( node_ptr ptr )</div><div class="line">    &#123;</div><div class="line">        if( ptr )</div><div class="line">        &#123;</div><div class="line">            for( auto p : ptr-&gt;next )</div><div class="line">            &#123;</div><div class="line">                clear( p );</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            delete ptr;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="插入元素"><a href="#插入元素" class="headerlink" title="插入元素"></a>插入元素</h2><p>　　调用<code>insert()</code>来插入键值对：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">( <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;key, <span class="keyword">const</span> T &amp;value )</span></span></div><div class="line">&#123;</div><div class="line">    insert( root_, key, value, <span class="number">0</span> );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">( node_ptr &amp;ptr, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;key, <span class="keyword">const</span> T &amp;value, <span class="keyword">int</span> i )</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>( !ptr )</div><div class="line">    &#123;</div><div class="line">        ptr = <span class="keyword">new</span> node;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>( i == key.size() )</div><div class="line">    &#123;</div><div class="line">        ptr-&gt;value = <span class="keyword">new</span> T( value );</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">char</span> index = key[i];</div><div class="line">    insert( ptr-&gt;next[index], key, value, i + <span class="number">1</span> );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="查找元素"><a href="#查找元素" class="headerlink" title="查找元素"></a>查找元素</h2><p>　　调用<code>get( key )</code>来返回一个指向 value 的指针，若指针为<code>nullptr</code>，则说明相应的 value 并不存在：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function">value_ptr <span class="title">get</span><span class="params">( <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;key )</span> <span class="keyword">const</span></span></div><div class="line">&#123;</div><div class="line">    node_ptr ptr = get( root_, key, <span class="number">0</span> );</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>( !ptr )</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// ptr-&gt;value may be a null pointer, that means no value corresponds to the key</span></div><div class="line">    <span class="keyword">return</span> ptr-&gt;value;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">node_ptr <span class="title">get</span><span class="params">( node_ptr ptr, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;key, <span class="keyword">int</span> i )</span> <span class="keyword">const</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>( !ptr )</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>( i == key.size() )</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> ptr;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">char</span> index = key[i];</div><div class="line">    <span class="keyword">return</span> get( ptr-&gt;next[index], key, i + <span class="number">1</span> );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="查找前缀"><a href="#查找前缀" class="headerlink" title="查找前缀"></a>查找前缀</h2><p>　　按前缀查找树中的键：</p>
<ul>
<li><code>keys()</code>返回树中的所有键。</li>
<li><code>keysWithPrefix( prefix )</code>返回所有以<code>prefix</code>开头的键。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; keys() <span class="keyword">const</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> keysWithPrefix( <span class="string">""</span> );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; keysWithPrefix( <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;prefix ) <span class="keyword">const</span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; keys;</div><div class="line">    <span class="keyword">auto</span> ptr = get( root_, prefix, <span class="number">0</span> );</div><div class="line">    collect( ptr, prefix, keys );</div><div class="line">    <span class="keyword">return</span> keys;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">collect</span><span class="params">( node_ptr ptr, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;prefix, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; &amp;keys )</span> <span class="keyword">const</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>( ptr == <span class="literal">nullptr</span> )</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>( ptr-&gt;value != <span class="literal">nullptr</span> )</div><div class="line">    &#123;</div><div class="line">        keys.push_back( prefix );</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">char</span> c = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">auto</span> p : ptr-&gt;next )</div><div class="line">    &#123;</div><div class="line">        collect( p, prefix + c, keys );</div><div class="line">        ++c;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://www.amazon.com/Algorithms-4th-Robert-Sedgewick/dp/032157351X/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1440840925&amp;sr=1-1&amp;keywords=algorithms" target="_blank" rel="external">Algorithms (4th Edition)</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/19/优先队列/" itemprop="url">
                  数据结构（三）-- 优先队列与堆排序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-10-19T20:01:10+08:00" content="2014-10-19">
              2014-10-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="优先队列"><a href="#优先队列" class="headerlink" title="优先队列"></a>优先队列</h2><p>　　二叉堆可分为大根堆和小根堆，在大根堆中，每个节点将大于或等于它的两个子节点，因此，根节点为大根堆的最大节点。<br>　　<br>　　可以使用数组表示二叉堆，<code>x[0]</code>弃之不用，我们用<code>x[1]</code>表示根节点。假定堆有 n 个元素并且满足大根堆的属性，那么需要满足 <code>x[i]</code> &lt;= <code>x[i/2]</code> ( n 取值 [2, n] )。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">template &lt;typename T&gt;</div><div class="line">class PriorityQueue</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">    explicit PriorityQueue()</div><div class="line">        : n( 0 ), x( 1 )</div><div class="line">    &#123;   </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    void push( const T &amp;elem )</div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    T pop()</div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">private:</div><div class="line">    int        n;          // for nodes' number</div><div class="line">    vector&lt;T&gt;  x;          </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>　　往堆中加入新节点：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">( <span class="keyword">const</span> T &amp;elem )</span></span></div><div class="line">&#123;</div><div class="line">    ++n;</div><div class="line">    x.push_back( elem );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　新节点位于<code>x[n]</code>，这时<code>x[1, ..., n]</code>可能不满足堆的属性：</p>
<ul>
<li>要是新节点大于它的父节点，则交换它们。</li>
<li>持续这个过程，直到新节点不大于它的父节点，即小于或等于它的父节点。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">( <span class="keyword">const</span> T &amp;elem )</span></span></div><div class="line">&#123;</div><div class="line">    ++n;</div><div class="line">    x.push_back( elem );</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">        invariant: </div><div class="line">        x[1, ..., n] is heap except perhaps x[i] and x[i / 2]</div><div class="line">    **/</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = n; i &gt; <span class="number">1</span> &amp;&amp; x[i] &gt; x[i / <span class="number">2</span>]; i /= <span class="number">2</span> )</div><div class="line">    &#123;</div><div class="line">        swap( x[i], x[i / <span class="number">2</span>] );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　另一个操作时<code>pop()</code>，也就是将最大的节点移除优先队列：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function">T <span class="title">pop</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    T maxElem = x[<span class="number">1</span>];</div><div class="line">    <span class="comment">/**</span></div><div class="line">        remove x[1], now x[2, ..., n] is a heap, our goal is make x[1, ..., n - 1] be a heap</div><div class="line">    **/</div><div class="line">    <span class="keyword">return</span> maxElem;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　移出了最大的节点<code>x[1]</code>，为了维持堆的属性，可以这样做：</p>
<ul>
<li>将最后一个节点<code>elem</code>放到<code>x[1]</code>，<code>n</code>减一 。</li>
<li>为了维持堆的属性，要是<code>elem</code>小于它的两个子节点的较大者，交换他们。</li>
<li>持续这个过程，直到<code>elem</code>大于或等于它的两个子节点。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function">T <span class="title">pop</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    T maxElem = x[<span class="number">1</span>];</div><div class="line">    x[<span class="number">1</span>] = x[n--];</div><div class="line">    x.pop_back();</div><div class="line">		</div><div class="line">    <span class="keyword">int</span> p;</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span>; ( p = i * <span class="number">2</span> ) &lt;= n; i = p )</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>( p &lt; n &amp;&amp; x[p] &lt; x[p + <span class="number">1</span>] )</div><div class="line">        &#123;</div><div class="line">            ++p;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>( x[i] &gt;= x[p] )</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        swap( x[i], x[p] );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> maxElem;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　完整的代码展示：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">template &lt;typename T&gt;</div><div class="line">class PriorityQueue</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">    explicit PriorityQueue()</div><div class="line">        : n( 0 ), x( 1 )</div><div class="line">    &#123;   </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    void push( const T &amp;elem )</div><div class="line">    &#123;</div><div class="line">        ++n;</div><div class="line">        x.push_back( elem );</div><div class="line">        </div><div class="line">        for( int i = n; i &gt; 1 &amp;&amp; x[i] &gt; x[i / 2]; i /= 2 )</div><div class="line">        &#123;</div><div class="line">            swap( x[i], x[i / 2] );</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    T pop()</div><div class="line">    &#123;</div><div class="line">        T maxElem = x[1];</div><div class="line">        x[1] = x[n--];</div><div class="line">        x.pop_back();</div><div class="line">		</div><div class="line">        int p;</div><div class="line">        for( int i = 1; ( p = i * 2 ) &lt;= n; i = p )</div><div class="line">        &#123;</div><div class="line">            if( p &lt; n &amp;&amp; x[p] &lt; x[p + 1] )</div><div class="line">            &#123;</div><div class="line">                ++p;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if( x[i] &gt;= x[p] )</div><div class="line">            &#123;</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">            swap( x[i], x[p] );</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return maxElem;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    bool empty() const</div><div class="line">    &#123;</div><div class="line">        return n == 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    int size() const</div><div class="line">    &#123;</div><div class="line">        return n;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">private:</div><div class="line">    int        n;</div><div class="line">    vector&lt;T&gt;  x;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h2><p>　　当我们了解了优先队列的实现原理，堆排序就容易实现了：</p>
<ul>
<li>先是构造大根堆。</li>
<li>将数组分成两部分，<code>x[1, ..., i]</code>表示堆, <code>x[i + 1, ..., n]</code>表示排定的数组。</li>
<li>交换<code>x[1]</code>和<code>x[i]</code>，这时，<code>x[2, ..., i - 1]</code>表示堆，<code>x[i, ..., n]</code>表示排定的数组。</li>
<li>将<code>x[1]</code>下移到合适位置，这时，<code>x[1, ..., i - 1]</code>表示堆，<code>x[i, ..., n]</code>表示排定的数组。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    make max-heap, the max element in x[1]</div><div class="line"> **/</div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">siftUp</span><span class="params">( T x[], <span class="keyword">int</span> n )</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = n; i &gt; <span class="number">1</span> &amp;&amp; x[i] &gt; x[i / <span class="number">2</span>]; i /= <span class="number">2</span> )</div><div class="line">    &#123;</div><div class="line">        swap( x[i], x[i / <span class="number">2</span>] );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    move x[1] down to the proper position</div><div class="line">**/</div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">siftDown</span><span class="params">( T x[], <span class="keyword">int</span> n )</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> p;</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span>; ( p = <span class="number">2</span> * i ) &lt;= n; i = p )</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>( p &lt; n &amp;&amp; x[p] &lt; x[p + <span class="number">1</span>] )</div><div class="line">        &#123;</div><div class="line">            ++p;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>( x[i] &gt;= x[p] )</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        swap( x[i], x[p] );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">heap_sort</span><span class="params">( T arr[], <span class="keyword">int</span> n )</span></span></div><div class="line">&#123;</div><div class="line">    T *x = arr - <span class="number">1</span>;           <span class="comment">// must minus 1</span></div><div class="line">    </div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i )</div><div class="line">    &#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">            invariant: x[1, ..., i - 1] is a heap</div><div class="line">        **/</div><div class="line">        siftUp( x, i );</div><div class="line">        <span class="comment">/**</span></div><div class="line">            now x[1, ..., i] is a heap</div><div class="line">        **/</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = n; i &gt;= <span class="number">2</span>; --i )</div><div class="line">    &#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">            x[1, ..., i] is a heap, x[i + 1, ..., n] is sorted</div><div class="line">        **/</div><div class="line">        swap( x[i], x[<span class="number">1</span>] );</div><div class="line">        <span class="comment">/**</span></div><div class="line">            x[2, ..., i - 1] is heap, x[i, ..., n] is sorted</div><div class="line">        **/</div><div class="line">        siftDown( x, i - <span class="number">1</span> );</div><div class="line">        <span class="comment">/**</span></div><div class="line">            x[1, ..., i - 1] is heap, x[i, ..., n] is sorted</div><div class="line">        **/</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://www.amazon.com/Programming-Pearls%C2%A0%C2%A0-PROGRAMMING-PEARLS-Paperback/dp/B008NY8KRU/ref=sr_1_1?ie=UTF8&amp;qid=1439018816&amp;sr=8-1&amp;keywords=programming+pearls+2+e" target="_blank" rel="external">Programming Pearls Second Edition</a></li>
<li><a href="http://www.amazon.com/Algorithms-4th-Robert-Sedgewick/dp/032157351X/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1440840925&amp;sr=1-1&amp;keywords=algorithms" target="_blank" rel="external">Algorithms (4th Edition)</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/15/Java-IO/" itemprop="url">
                  Java 高级特性（一） -- 输入与输出流
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-10-15T14:16:18+08:00" content="2014-10-15">
              2014-10-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　可以从<code>InputStream</code>中读取输入中的字节序列，并且可以从<code>OutputStream</code>中写入输出的字节序列，这两个类均为抽象类。但有时需要处理的并不是字节序列，而是<code>Unicode</code>字符，这时则可以使用<code>Reader</code>和<code>Writer</code>来处理<code>Unicode</code>字符。</p>
<h2 id="使用InputStream与OutputStream"><a href="#使用InputStream与OutputStream" class="headerlink" title="使用InputStream与OutputStream"></a>使用InputStream与OutputStream</h2><p>　　<code>InputStream</code>中拥有<code>abstract</code>的<code>read()</code>方法:</p>
<pre><code>public abstract int read() throws IOException
</code></pre><p>　　<code>read()</code>方法返回所读取到的字节，若遇到输入的末尾，则返回<code>-1</code>。从<code>InputStream</code>的对象<code>in</code>中读取<code>10</code>个字节:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">byte</span>[] input = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">10</span>];</div><div class="line"><span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; input.length; ++i ) &#123;</div><div class="line">    <span class="keyword">int</span> b = in.read();</div><div class="line">    <span class="keyword">if</span>( b == -<span class="number">1</span> ) &#123;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;  </div><div class="line">    input[i] = ( <span class="keyword">byte</span> )b;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　尽管<code>read()</code>读取的是一个字节，但其返回值为<code>int</code>类型，其中<code>read()</code>的返回值范围为<code>-128</code>到<code>127</code>，因此，需要显示将<code>int</code>类型转换成为<code>byte</code>类型。<br>　　在<code>InputStream</code>的具体子类中，将会覆写这个方法，例如，<code>FileInputStream</code>中的<code>read()</code>方法则用于从文件中读取一个字节。同样，<code>OutputStream</code>中的<code>write()</code>方法将会向输出中写入一个字节:</p>
<pre><code>public abstract int write() throws IOException
</code></pre><p>　　<code>read()</code>和<code>write()</code>方法，在输入流或输出流不可访问时，当前线程将会处于阻塞状态。这时，可以使用<code>available()</code>方法来判断当前所能读取的字节数，以此来避免处于阻塞状态:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> bytesAvailable = in.available();</div><div class="line"><span class="keyword">if</span>( bytesAvailable &gt; <span class="number">0</span> ) &#123;</div><div class="line">    <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[bytesAvailable];</div><div class="line">    in.read( data );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　<code>InputStream</code>、<code>OutputStream</code>、<code>Reader</code>和<code>Writer</code>均实现了<code>Closeable</code>接口，<code>Closeable</code>接口中仅包含<code>close()</code>方法:</p>
<pre><code>public void close() throws IOException
</code></pre><p>　　<code>OutputStream</code>和<code>Writer</code>均实现了<code>Flushable</code>接口，<code>Flushable</code>接口中包含<code>flush()</code>方法:</p>
<pre><code>void flush()
</code></pre><p>　　创建<code>InputStream</code>或<code>OutputStream</code>用于读取或写入操作，在操作执行结束之后，需要使用<code>close()</code>来关闭输入流或输出流。这可以用来释放系统资源，此外，关闭输出流也会刷新缓冲区中的数据。<br>　　若需要读取文件中的内容，或向文件中进行写入，则可以使用<code>FileInputStream</code>和<code>FileOutputStream</code>类型:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">String fileName = <span class="string">"text"</span>;</div><div class="line"><span class="keyword">try</span>( FileInputStream fin = <span class="keyword">new</span> FileInputStream( fileName ) ) &#123;</div><div class="line">    <span class="keyword">byte</span> byteData;</div><div class="line">    <span class="keyword">while</span>( ( byteData = ( <span class="keyword">byte</span> )fin.read() ) != -<span class="number">1</span> ) &#123;</div><div class="line">        System.out.print( (<span class="keyword">char</span>)byteData );</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">catch</span>( FileNotFoundException e ) &#123;</div><div class="line">    System.out.println( <span class="string">"ERROR: Can't find file "</span> + fileName );</div><div class="line">&#125; <span class="keyword">catch</span>( IOException e ) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　有时需要以二进制的形式读取或写入基本类型，这时则可以使用<code>DataInputStream</code>和<code>DataOuputStream</code>类型。例如，使用<code>DataOutputStream</code>向文件中写入基本类型的二进制数据:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">String fileName = <span class="string">"data.dat"</span>;</div><div class="line"><span class="keyword">try</span>( DataOutputStream out = <span class="keyword">new</span> DataOutputStream( <span class="keyword">new</span> FileOutputStream( fileName ) ) ) &#123;</div><div class="line">    out.writeInt( <span class="number">100</span> );</div><div class="line">    out.writeDouble( <span class="number">99.99</span> );</div><div class="line">    out.writeBoolean( <span class="keyword">true</span> );</div><div class="line">    out.writeUTF( <span class="string">"senlin"</span> );</div><div class="line">    out.flush();</div><div class="line">&#125; <span class="keyword">catch</span>( FileNotFoundException e ) &#123;</div><div class="line">    System.out.println( <span class="string">"Can't find the file "</span> + fileName );          </div><div class="line">&#125; <span class="keyword">catch</span>( IOException e ) &#123;</div><div class="line">    System.err.println( e );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　此外，可以使用<code>DataInputStream</code>来读取基本类型的二进制数据:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">String fileName = <span class="string">"data.dat"</span>;</div><div class="line"><span class="keyword">try</span>( DataInputStream in = <span class="keyword">new</span> DataInputStream( <span class="keyword">new</span> FileInputStream( fileName ) ) ) &#123;</div><div class="line">    System.out.println( in.readInt() );</div><div class="line">    System.out.println( in.readDouble() );</div><div class="line">    System.out.println( in.readBoolean() );</div><div class="line">    System.out.println( in.readUTF() );</div><div class="line">&#125; <span class="keyword">catch</span>( FileNotFoundException e ) &#123;</div><div class="line">    System.out.println( <span class="string">"Can't find the file "</span> + fileName );</div><div class="line">&#125; <span class="keyword">catch</span>( IOException e ) &#123;</div><div class="line">    System.err.println( e );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　由于<code>writeUTF()</code>使用的并不是标准的<code>UTF-8</code>编码，因此，使用<code>writeUFT()</code>来写入字符串数据时，数据仅适用于<code>Java</code>程序来处理，若数据需要被其它的非<code>Java</code>程序处理，则应使用<code>writeChars()</code>来写入字符串数据。<br>　　在输入流中读取字节和向输出流写入字节时，使用<code>BufferedInputStream</code>和<code>BufferdOutputStream</code>将显得更为高效，例如，<code>BufferedInputStream</code>每次将会向操作系统请求较大的数据块存储在缓冲区中，每次读取字节时就会从这个缓冲区中进行读取:</p>
<pre><code>DataInputStream in = new DataInputStream( new BufferedInputStream( new FileInputStream( &quot;data.dat&quot; ) ) );
</code></pre><h2 id="使用Reader与Writer"><a href="#使用Reader与Writer" class="headerlink" title="使用Reader与Writer"></a>使用Reader与Writer</h2><p>　　抽象类<code>Reader</code>与<code>Writer</code>用来处理<code>unicode</code>文本。其中，<code>Writer</code>实现了<code>Appendable</code>接口，这个接口中含有重载的<code>append()</code>方法:</p>
<pre><code>Appendable append(char c) throws IOException 
Appendable append(CharSequence s) throws IOException
Appendable append(CharSequence s, int start, int end) throws IOException
</code></pre><p>　　<code>String</code>、<code>CharBuffer</code>、<code>StringBuilder</code>和<code>StringBuffer</code>均实现了<code>CharSequence</code>接口。<br>　　在<code>Reader</code>和<code>Writer</code>的子类中，<code>InputStreamReader</code>和<code>OutputStreamWriter</code>提供了一种途径，用于实现基于字节的流与基于字符的流的互相转换，例如，当存在<code>InputStream</code>时，若此时需要根据这个<code>InputStream</code>得到<code>Reader</code>，则可以将<code>InputStream</code>对象作为<code>InputStreamReader</code>的构造方法的参数，以此来构造<code>InputStreamReader</code>对象。<br>　　<code>InputStreamReader</code>用于将输入的字节流转换成为包含<code>Unicode code unit</code>的输入流，默认情况下，<code>InputStreamReader</code>使用本地系统指定的编码方式，此外，也可在<code>InputStreamReader</code>的构造方法中指定其它的编码:</p>
<pre><code>InputstreamReader in = new InputstreamReader( new FileInputStream( &quot;data.dat&quot; ), &quot;ISO8859_5&quot; ); 
</code></pre><p>　　类似的，<code>OutputStreamWriter</code>则用于将输出流中的<code>Unicode code unit</code>转换成相应的字节。<br>　　若需要将文本写入到输出中，则可以使用<code>PrintWriter</code>，<code>PrintWriter</code>存在构造函数用于直接指定文件名:</p>
<pre><code>PrintWriter out = new PrintWriter( &quot;data.txt&quot; );
</code></pre><p>　　这等价于:</p>
<pre><code>PrintWriter out = new PrintWriter( new FileWriter( &quot;data.txt&quot; ) );
</code></pre><p>　　可以使用<code>PrintWriter</code>的<code>print()</code>、<code>println()</code>和<code>printf()</code>方法用于向输出中写入文本，其中，<code>println()</code>方法将根据所使用的系统来确定将使用的换行符，例如，在<code>Windows</code>系统中，将使用<code>&quot;\r\n&quot;</code>作为换行符，而在<code>Unix</code>系统中，则使用<code>&quot;\n&quot;</code>作为换行符。<br>　　可以将<code>PrintWriter</code>指定为自动刷新的，这样，每次调用<code>println()</code>方法之后，缓冲区中的字符将会立即写进输出中:</p>
<pre><code>PrintWriter out = new PrintWriter( new FileWriter( &quot;data.txt&quot; ), true );
</code></pre><p>　　<code>print()</code>方法并不会抛出任何异常，因此，可以使用<code>checkError()</code>方法来判断是否出现异常。<br>　　为向输出中写入文本，可以使用带缓冲的<code>BufferedWriter</code>，由于<code>Writer</code>实现了<code>Appendable</code>接口，因此，<code>BufferedWriter</code>可以使用<code>Appendable</code>接口中的<code>append()</code>方法，此外，<code>BufferedWriter</code>中存在其它的方法:</p>
<pre><code>public void write(int c) throws IOException
public void write(char[] cbuf, int off, int len) throws IOException
public void write(String s, int off, int len) throws IOException
public void newLine() throws IOException
public void flush() throws IOException
public void close() throws IOException
</code></pre><p>　　其中，<code>newLine()</code>方法将会写入换行符，换行符将会根据本地系统来指定:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">String fileName = <span class="string">"text.txt"</span>;</div><div class="line"><span class="keyword">try</span>( BufferedWriter writer = <span class="keyword">new</span> BufferedWriter( <span class="keyword">new</span> FileWriter( fileName ) ) ) &#123;</div><div class="line">    writer.append( <span class="string">"Hello: "</span> );</div><div class="line">    writer.append( <span class="string">"senlin "</span> );</div><div class="line">    writer.newLine();</div><div class="line">    writer.flush();              </div><div class="line">&#125; <span class="keyword">catch</span>( FileNotFoundException e ) &#123;</div><div class="line">    System.out.println( <span class="string">"Can't not find file "</span> + fileName );</div><div class="line">&#125; <span class="keyword">catch</span>( IOException e ) &#123;</div><div class="line">    System.err.println( e );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　同样，若需要在文本文件中读取文本，则可以使用<code>BufferedReader</code>，其<code>readLine()</code>方法可以用来读取一行文本:</p>
<pre><code>public String readLine() throws IOException  
</code></pre><p>　　使用<code>readLine()</code>时，以<code>&quot;\r\n&quot;</code>、<code>&quot;\r&quot;</code>或<code>&quot;\n&quot;</code>结尾的都会被认为是一行文本:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">String fileName = <span class="string">"text.txt"</span>;</div><div class="line"><span class="keyword">try</span>( BufferedReader reader = <span class="keyword">new</span> BufferedReader( <span class="keyword">new</span> FileReader( fileName ) ) ) &#123;</div><div class="line">    String line = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">while</span>( ( line = reader.readLine() ) != <span class="keyword">null</span> ) &#123;</div><div class="line">        System.out.println( line );</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">catch</span>( FileNotFoundException e ) &#123;</div><div class="line">    System.out.println( <span class="string">"Can't not find file "</span> + fileName );</div><div class="line">&#125; <span class="keyword">catch</span>( IOException e ) &#123;</div><div class="line">    System.err.println( e );</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://www.amazon.com/Core-Java-II--Advanced-Features-9th/dp/013708160X/ref=sr_1_2?ie=UTF8&amp;qid=1416923218&amp;sr=8-2&amp;keywords=core+java+9" target="_blank" rel="external">Core Java, Volume II–Advanced Features (9th Edition)</a></li>
<li><a href="http://www.amazon.com/Network-Programming-Elliotte-Rusty-Harold/dp/1449357679/ref=sr_1_1?ie=UTF8&amp;qid=1416923330&amp;sr=8-1&amp;keywords=java+network" target="_blank" rel="external">Java Network Programming (4th Edition)</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/10/C-网络编程一/" itemprop="url">
                  Boost.Asio C++ 网络编程（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-10-10T11:00:38+08:00" content="2014-10-10">
              2014-10-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/网络编程/" itemprop="url" rel="index">
                    <span itemprop="name">网络编程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Asio的介紹"><a href="#Asio的介紹" class="headerlink" title="Asio的介紹"></a>Asio的介紹</h2><p>　　<code>Asio</code>是异步<code>(asynchronous)</code>的输入输出库，使用<code>Asio</code>库的好处在于，<strong>在程序中异步地执行任务时，程序并不会一直处于阻塞的状态</strong>，也就是说从异步任务的开始执行到执行结束期间，程序可以继续执行当前的任务，而当异步执行的任务结束时，程序将会收到一个通知，这个通知用来说明异步任务已经执行结束。</p>
<p>　　在<code>Asio</code>库中，异步地执行数据处理需要依赖于<code>IO</code>设备和<code>IO</code>对象，程序使用<code>IO</code>设备用于与底层操作系统进行交互，而<code>IO</code>对象则负责执行特定的<code>IO</code>操作，例如使用<code>IO</code>对象来进行网络连接。显然，<code>IO</code>设备是程序与操作系统进行交互的桥梁，那么，当程序使用<code>IO</code>对象执行操作时，<code>IO</code>对象执行的操作需要通过<code>IO</code>设备才能与系统进行交互。 </p>
<h2 id="使用定时器"><a href="#使用定时器" class="headerlink" title="使用定时器"></a>使用定时器</h2><p>　　在<code>Asio</code>库中，<code>boost::asio::io_service</code>用来唯一地表示<code>IO</code>设备，与此不同，<code>IO</code>对象则可以由多个类来表示，例如，<code>boost::asio::steady_timer</code>表示定时器，定时器可以用来设定经过特定的时间才会触发，此外，<code>boost::asio::socket</code>可以用来通过网络发送和接受数据。</p>
<h3 id="同步地使用定时器"><a href="#同步地使用定时器" class="headerlink" title="同步地使用定时器"></a>同步地使用定时器</h3><p>　　对于定时器来说，除了可以异步地使用定时器之外，也可以同步地使用定时器。首先看一下同步地使用定时器的例子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#include &lt;boost/asio/io_service.hpp&gt;</div><div class="line">#include &lt;boost/asio/steady_timer.hpp&gt;</div><div class="line">#include &lt;chrono&gt;</div><div class="line">#include &lt;iostream&gt;</div><div class="line">using namespace boost::asio;</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">    io_service ioservice;</div><div class="line">    steady_timer timer&#123; ioservice, std::chrono::seconds&#123; 5 &#125; &#125;;</div><div class="line">    timer.wait();              // 程序将会在这里阻塞5秒</div><div class="line">    std::cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; std::endl;  </div><div class="line">    </div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　所有使用<code>Asio</code>库的程序都需要使用到<code>IO</code>设备，因此，程序中首先需要创建<code>boost::asio::io_service</code>对象。对于表示<code>IO</code>对象的类来说，其构造函数的第一个参数通常为<code>io_service</code>的引用，因此，这里需要将<code>io_service</code>对象<code>ioservice</code>传递给<code>steady_timer</code>的构造函数，并且，由于定时器需要知道经过多长的时间才触发，因此，需要为<code>steady_timer</code>提供另一个参数用来指定触发的时间。</p>
<p>　　调用<code>steady_timer::wait()</code>并不会立即返回，在创建<code>timer</code>之后经过5秒时间，<code>steady_timer::wait()</code>才会返回。</p>
<h3 id="异步地使用定时器"><a href="#异步地使用定时器" class="headerlink" title="异步地使用定时器"></a>异步地使用定时器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#include &lt;boost/asio/io_service.hpp&gt;</div><div class="line">#include &lt;boost/asio/steady_timer.hpp&gt;</div><div class="line">#include &lt;chrono&gt;</div><div class="line">#include &lt;iostream&gt;</div><div class="line">using namespace boost::asio;</div><div class="line"></div><div class="line">void print_message( const boost::system::error_code&amp; /* e*/ )</div><div class="line">&#123;</div><div class="line">    std::cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; std::endl;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main(int argc, char *argv[])</div><div class="line">&#123;</div><div class="line">    io_service ioservice;</div><div class="line">    steady_timer timer&#123; ioservice, std::chrono::seconds&#123; 5 &#125; &#125;;</div><div class="line">    // 调用async_wait()会立即返回，不会阻塞</div><div class="line">    timer.async_wait( print_message ); </div><div class="line"></div><div class="line">    std::cout &lt;&lt; &quot;before print_message()&quot; &lt;&lt; std::endl;</div><div class="line">    // 程序处于阻塞状态，当定时器触发之后程序会执行print_message()函数</div><div class="line">    // 当print_message()执行结束之后，run()才会返回</div><div class="line">    ioservice.run(); </div><div class="line">    std::cout &lt;&lt; &quot;after print_message()&quot; &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　程序的输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">before print_message()</div><div class="line">Hello, World!</div><div class="line">after print_message()</div></pre></td></tr></table></figure></p>
<p>　　调用<code>async_wait()</code>会使定时器进入异步等待状态，与<code>wait()</code>不同，<code>async_wait()</code>在调用之后将会立即返回，并不会阻碍到程序执行其它任务。<code>async_wait()</code>接受一个回调函数<code>print_message()</code>，这表示，当创建<code>timer</code>对象之后经过<code>5</code>秒的时间，程序将会调用<code>print_message()</code>函数。</p>
<p>　　在调用<code>async_wait()</code>之后，程序需要调用<code>io_service::run()</code>函数，调用<code>io_service::run()</code>函数会使程序处于阻塞状态，等待定时器的触发，当定时器触发时，程序将调用<code>print_message()</code>函数，在此之后，<code>io_service::run()</code>函数才会返回。<br>　　<br>　　此外，<code>Asio</code>库保证了回调函数会与<code>io_service::run()</code>函数在同一线程中被执行，因此，调用<code>io_service::run()</code>函数保证了程序能够执行<code>print_message()</code>函数。若程序没有调用<code>io_service::run()</code>函数，那么在调用<code>async_wait()</code>之后，<code>main()</code>将会立即返回，此时，<code>print_message()</code>将不会被执行。</p>
<p>　　在C++11中，可以使用<code>lambda</code>表达式替代回调函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">timer.async_wait( []( const boost::system::error_code&amp; /* e */ ) &#123;</div><div class="line">    std::cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; std::endl;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="处理回调函数"><a href="#处理回调函数" class="headerlink" title="处理回调函数"></a>处理回调函数</h2><h3 id="为回调函数绑定参数"><a href="#为回调函数绑定参数" class="headerlink" title="为回调函数绑定参数"></a>为回调函数绑定参数</h3><p>　　<code>async_wait()</code>要求回调函数接受<code>const boost::system::error_code &amp;</code>类型的参数，若回调函数需要接受其它额外的参数，这时则需要使用<code>std::bind()</code>来绑定额外的参数。</p>
<p>　　例如，若我们需要程序能够使用同一个定时器实现多次触发，那么就需要在回调函数中重新设定定时器的触发时间，使得定时器能够在特定的时间之后再次触发，这时在回调函数中则显然需要访问<code>steady_timer</code>对象的引用，此外，还需要使用<code>int</code>类型变量来限定定时器的触发次数，这也需要在回调函数中访问这个<code>int</code>变量的引用。</p>
<p>　　因此，<code>print_message()</code>需要具有3个参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">#include &lt;boost/asio/io_service.hpp&gt;</div><div class="line">#include &lt;boost/asio/steady_timer.hpp&gt;</div><div class="line">#include &lt;functional&gt;</div><div class="line">#include &lt;chrono&gt;</div><div class="line">#include &lt;iostream&gt;</div><div class="line">using namespace boost::asio;</div><div class="line"></div><div class="line">void print_message( const boost::system::error_code &amp; /* e */,</div><div class="line">                    steady_timer &amp;timer, int &amp;count )</div><div class="line">&#123;</div><div class="line">    if( count &lt; 5 ) &#123;</div><div class="line">        std::cout &lt;&lt; count &lt;&lt; std::endl;</div><div class="line">        ++count;</div><div class="line">        // 设定定时器下一秒触发</div><div class="line">        timer.expires_at( timer.expires_at() + std::chrono::seconds( 1 ) ); </div><div class="line">        timer.async_wait( std::bind( print_message, std::placeholders::_1,</div><div class="line">                                     std::ref( timer ), std::ref( count ) ) );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">    int count = 0;</div><div class="line">    io_service ioservice;</div><div class="line">    steady_timer timer( ioservice, std::chrono::seconds( 1 ) );</div><div class="line">    timer.async_wait( std::bind( print_message, std::placeholders::_1, </div><div class="line">                                 std::ref( timer ), std::ref( count ) ) );</div><div class="line"></div><div class="line">    ioservice.run();</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　定时器总共会触发<code>5</code>次，程序的执行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">0</div><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td></tr></table></figure></p>
<h3 id="使用成员函数作为回调函数"><a href="#使用成员函数作为回调函数" class="headerlink" title="使用成员函数作为回调函数"></a>使用成员函数作为回调函数</h3><p>　　也可以将类的成员函数作为回调函数来使用，<code>printer</code>类接受<code>io_service</code>对象的引用来初始化其<code>timer</code>成员。注意，对于所有的<code>non-static</code>成员函数来说，都将接受一个隐式的<code>this</code>参数，因此，使用<code>std::bind()</code>时，需要传递一个<code>this</code>参数给类的成员函数，编译器才能知道调用的成员函数属于哪个对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">#include &lt;boost/asio/io_service.hpp&gt;</div><div class="line">#include &lt;boost/asio/steady_timer.hpp&gt;</div><div class="line">#include &lt;functional&gt;</div><div class="line">#include &lt;chrono&gt;</div><div class="line">#include &lt;iostream&gt;</div><div class="line">using namespace boost::asio;</div><div class="line"></div><div class="line">class printer</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">    printer( boost::asio::io_service &amp;service )</div><div class="line">        : timer( service, std::chrono::seconds( 1 ) ) &#123;</div><div class="line">        timer.async_wait( std::bind( &amp;printer::print_message, this ) );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    void print_message() &#123;</div><div class="line">        if( count &lt; 5 ) &#123;</div><div class="line">            std::cout &lt;&lt; count &lt;&lt; std::endl;</div><div class="line">            ++count;</div><div class="line">            // 设定定时器下一秒触发</div><div class="line">            timer.expires_at( timer.expires_at() + std::chrono::seconds( 1 ) ); </div><div class="line">            // 异步地等待定时器触发</div><div class="line">            timer.async_wait( std::bind( &amp;printer::print_message, this ) ); </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">private:</div><div class="line">    boost::asio::steady_timer timer;</div><div class="line">    int count = 0;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">    io_service ioservice;</div><div class="line">    printer p( ioservice );</div><div class="line">    </div><div class="line">    ioservice.run();</div><div class="line">    </div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　最后，可以看到，尽管<code>async_wait()</code>要求回调函数接受<code>const boost::system::error_code &amp;</code>类型的参数，但通过使用<code>std::bind()</code>之后，回调函数也可以不接受<code>const boost::system::error_code &amp;</code>类型的参数，例如，<code>printer</code>的成员函数<code>print_message()</code>并不接受任何参数。</p>
<h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><p>　　在程序中使用多线程，则程序可以充分利用计算机的多核处理器，这时，程序可以<strong>并发地执行多个任务</strong>。</p>
<h3 id="创建多条线程"><a href="#创建多条线程" class="headerlink" title="创建多条线程"></a>创建多条线程</h3><p>　　由于在一条线程中调用<code>io_service</code>的<code>run()</code>成员函数时，相应的回调函数也会在这条线程中执行，这就使得多个回调函数无法并发地执行，因此，要是在程序中启动多条线程，程序就能多次调用<code>io_service</code>的<code>run()</code>成员函数，这样，在具有多核处理器的计算机中，当多个回调函数需要同时执行时，它们就能并发地执行。例如，当一个异步等待任务结束时，程序将会调用相应的回调函数，此时，在第一个异步等待任务结束时若存在另一异步等待任务也立即结束，这时，程序将在另一线程中调用第二个异步等待任务对应的回调函数，因此，这两个回调函数就能够并发地执行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">#include &lt;boost/asio/io_service.hpp&gt;</div><div class="line">#include &lt;boost/asio/steady_timer.hpp&gt;</div><div class="line">#include &lt;chrono&gt;</div><div class="line">#include &lt;thread&gt;</div><div class="line">#include &lt;iostream&gt;</div><div class="line">using namespace boost::asio;</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">    io_service ioservice;</div><div class="line">    steady_timer timer1&#123; ioservice, std::chrono::seconds( 1 ) &#125;;</div><div class="line">    timer1.async_wait( []( const boost::system::error_code &amp; /* e */ ) &#123;</div><div class="line">        for( int i = 0; i &lt; 5; ++i ) &#123;</div><div class="line">            std::cout &lt;&lt; &quot;message from timer1.&quot; &lt;&lt; std::endl;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    steady_timer timer2&#123; ioservice, std::chrono::seconds( 1 ) &#125;;</div><div class="line">    timer1.async_wait( []( const boost::system::error_code &amp; /* e */ ) &#123;</div><div class="line">        for( int i = 0; i &lt; 5; ++i ) &#123;</div><div class="line">            std::cout &lt;&lt; &quot;message from timer2.&quot; &lt;&lt; std::endl;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    std::thread thread1&#123; [&amp;ioservice]()&#123; ioservice.run(); &#125; &#125;;</div><div class="line">    std::thread thread2&#123; [&amp;ioservice]()&#123; ioservice.run(); &#125; &#125;;</div><div class="line"></div><div class="line">    thread1.join();</div><div class="line">    thread2.join();</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　程序可能的运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">message from timer1.message from timer2.</div><div class="line">message from timer1.</div><div class="line">message from timer1.</div><div class="line">message from timer1.</div><div class="line">message from timer1.</div><div class="line"></div><div class="line">message from timer2.</div><div class="line">message from timer2.</div><div class="line">message from timer2.</div><div class="line">message from timer2.</div></pre></td></tr></table></figure></p>
<p>　　可以看到，两条线程的输出内容可能会交错在一起，这是由于<code>std::cout</code>对象在两条线程之间共享。为了使两条线程的输出不交错，则需要同步地访问<code>std::cout</code>对象，但是，<strong>同步访问带来的后果就是两条线程无法并发地执行</strong>。</p>
<h3 id="多条线程同步访问共享资源"><a href="#多条线程同步访问共享资源" class="headerlink" title="多条线程同步访问共享资源"></a>多条线程同步访问共享资源</h3><p>　　当需要在多条线程中访问共享资源时，多条线程需要同步地访问资源。例如，当需要在多个回调函数中访问共享的资源时，可以使用<code>boost::asio::strand</code>来<strong>调度</strong><code>(dispatched)</code><strong>这多个回调函数</strong>，<code>boost::asio::strand</code><strong>保证其调度的回调函数会有序地执行</strong>，即仅有当一个回调函数执行结束时才会调用另一个回调函数，这就保证了共享资源可以在多条线程中被共享地访问。<br>　　应当注意，当多个回调函数由不同的<code>boost::asio::strand</code>对象调度时，这多个回调函数<strong>仍允许并发地执行</strong>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">#include &lt;boost/asio/io_service.hpp&gt;</div><div class="line">#include &lt;boost/asio/steady_timer.hpp&gt;</div><div class="line">#include &lt;boost/asio/strand.hpp&gt;</div><div class="line">#include &lt;chrono&gt;</div><div class="line">#include &lt;thread&gt;</div><div class="line">#include &lt;iostream&gt;</div><div class="line">using namespace boost::asio;</div><div class="line"></div><div class="line">void printMessage1( const boost::system::error_code &amp; /* e */ ) &#123;</div><div class="line">    for( int i = 0; i &lt; 5; ++i ) &#123;</div><div class="line">        std::cout &lt;&lt; &quot;message from timer1.&quot; &lt;&lt; std::endl;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void printMessage2( const boost::system::error_code &amp; /* e */ ) &#123;</div><div class="line">    for( int i = 0; i &lt; 5; ++i ) &#123;</div><div class="line">        std::cout &lt;&lt; &quot;message from timer2.&quot; &lt;&lt; std::endl;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">    io_service ioservice;</div><div class="line">    strand s&#123; ioservice &#125;;</div><div class="line">    steady_timer timer1&#123; ioservice, std::chrono::seconds&#123; 1 &#125; &#125;;</div><div class="line">    timer1.async_wait( s.wrap( printMessage1 ) );</div><div class="line">    </div><div class="line">    steady_timer timer2&#123; ioservice, std::chrono::seconds&#123; 1 &#125; &#125;;</div><div class="line">    timer1.async_wait( s.wrap( printMessage2 ) );</div><div class="line"></div><div class="line">    std::thread thread1&#123; [&amp;ioservice]()&#123; ioservice.run(); &#125; &#125;;</div><div class="line">    std::thread thread2&#123; [&amp;ioservice]()&#123; ioservice.run(); &#125; &#125;;</div><div class="line"></div><div class="line">    thread1.join();</div><div class="line">    thread2.join();</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　程序的输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">message from timer1.</div><div class="line">message from timer1.</div><div class="line">message from timer1.</div><div class="line">message from timer1.</div><div class="line">message from timer1.</div><div class="line">message from timer2.</div><div class="line">message from timer2.</div><div class="line">message from timer2.</div><div class="line">message from timer2.</div><div class="line">message from timer2.</div></pre></td></tr></table></figure></p>
<p>　　可以看到，两条线程的输出内容并<strong>不会交错在一起</strong>。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://www.boost.org/doc/libs/1_55_0/doc/html/boost_asio.html" target="_blank" rel="external">Boost.Asio</a></li>
<li><a href="http://book.douban.com/subject/10440485/" target="_blank" rel="external">The C++ Standard Library Second Edition</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/04/array使用/" itemprop="url">
                  高效 C++11 -- 使用 array
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-10-04T19:22:08+08:00" content="2014-10-04">
              2014-10-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="定长数组"><a href="#定长数组" class="headerlink" title="定长数组"></a>定长数组</h2><p>　　<code>C++11</code>中引入了<code>array</code>容器，<code>array</code>是序列容器的一种。<code>array</code>很类似于一般的数组，例如，<code>array</code>在栈上分配连续的内存来储存元素，并且<code>array</code>的大小是不可以改变的，这也就是说，可以修改<code>array</code>中元素的值，但不能向<code>array</code>中插入和删除元素。</p>
<p>　　<code>array</code>具有序列容器的特点，同时又具有一般数组的特点，实际上，在程序中需要使用数组的地方，都可以使用<code>array</code>来代替，使用<code>array</code>更为安全，除了具有一般数组的灵活性，还具有与一般数组相近的性能优势。</p>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>　　<code>array</code>是具有固定大小的容器，这就是说，在定义<code>array</code>对象时就需要显式指定其所能容纳元素的数目，并且这个数目一经指定就不可再改变了。其它的序列容器，例如，新创建的<code>vector</code>对象并不包含任何元素，而<code>array</code>在创建时就拥有固定数目的元素，并且这些元素将会进行初始化。在创建<code>array</code>时使用初始化列表作为<code>array</code>的初始值：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">array</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr1 = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;          <span class="comment">// arr1包含：1 2 3 4 5  </span></div><div class="line">    <span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr2 = &#123; <span class="number">0</span> &#125;;                      <span class="comment">// arr2包含：0 0 0 0 0</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　如果<code>array</code>中包含的是基本类型，并且没有提供初始化值，则<code>array</code>中元素的值是未定义的：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr;         <span class="comment">// arr中元素的值是未定义的</span></div></pre></td></tr></table></figure></p>
<h2 id="赋值与交换"><a href="#赋值与交换" class="headerlink" title="赋值与交换"></a>赋值与交换</h2><p>　　  使用<code>array</code>的一个好处就是可以将一个相同类型的<code>array</code>对象赋值给另一个对象，<code>array</code>中的元素将会依次进行复制，因此，在赋值之后，两个<code>array</code>具有相同的元素，但需要保证两个<code>array</code>具有相同的元素类型以及大小。但对于一般数组，则不能这样做。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr1 = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;  </div><div class="line"><span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr2 = &#123; <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span> &#125;;  </div><div class="line"><span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr3 = arr1;                  <span class="comment">// arr3 包含：1 2 3 4 5  </span></div><div class="line">arr3 = arr2;                                <span class="comment">// arr3 包含：5 4 3 2 1</span></div></pre></td></tr></table></figure></p>
<p>　　注意，仅能将一个相同类型的<code>array</code>赋值给另一个<code>array</code>，但不能使用初始化列表来赋值<code>array</code>对象:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr1 = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;  </div><div class="line"><span class="comment">// ERROR: arr1 = &#123; 1, 2, 3 &#125;;                         不能使用初始化列表来向array赋值</span></div></pre></td></tr></table></figure></p>
<p>　　可以使用<code>array</code>的成员函数<code>fill()</code>来将<code>array</code>中的元素赋为相同的值:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr;  </div><div class="line">arr.fill( <span class="number">9</span> );                <span class="comment">// arr包含： 9 9 9 9 9</span></div></pre></td></tr></table></figure></p>
<p>　　对于其它的序列容器，比如<code>vector</code>，可以使用<code>swap()</code>来交换两个<code>vector</code>，此时，使用<code>swap()</code>具有常量时间复杂度，显得特别高效，这是因为<code>vector</code>中拥有指向动态分配内存的指针，因此，使用<code>swap()</code>交换两个<code>vector</code>仅需要交换其内部指向动态内存的指针即可。同样，可以使用<code>swap()</code>来交换两个<code>array</code>，但由于<code>array</code>在栈上为元素分配内存，<code>array</code>内部并没有包含指向动态内存的指针，因此，使用<code>swap()</code>来交换两个<code>array</code>具有线性时间复杂度，因为交换两个<code>array</code>将会涉及到元素的逐一复制。<code>swap</code>有两种等价的形式，一种作为泛型的算法，另一种则作为<code>array</code>的成员函数:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr1 = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;  </div><div class="line"><span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr2 = &#123; <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span> &#125;;  </div><div class="line">swap( arr1, arr2 );  </div><div class="line">arr1.swap( arr2 );                      <span class="comment">// 等价于： swap( arr1, arr2 );</span></div></pre></td></tr></table></figure></p>
<h2 id="历遍array"><a href="#历遍array" class="headerlink" title="历遍array"></a>历遍array</h2><p>　　 <code>array</code>中具有成员函数<code>size()</code>用来获得<code>array</code>中元素的数目：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">array</span>&lt;<span class="keyword">int</span>, 5&gt; arr = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;  </div><div class="line"><span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i != arr.size() ; ++i )  </div><div class="line">&#123;  </div><div class="line">    <span class="built_in">cout</span> &lt;&lt; arr[i] &lt;&lt; <span class="string">" "</span>;  </div><div class="line">&#125;  </div><div class="line"><span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</div></pre></td></tr></table></figure></p>
<p>　　<code>array</code>是序列容器的一种，可以使用迭代器的方式来历遍<code>array</code>，也可以使用<code>for-each</code>循环来历遍<code>array</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">array&lt;int, 5&gt; arr = &#123; 1, 2, 3, 4, 5 &#125;;  </div><div class="line">for( auto elem : arr )  </div><div class="line">    cout &lt;&lt; elem &lt;&lt; &quot; &quot;;  </div><div class="line">cout &lt;&lt; endl;  </div><div class="line">  </div><div class="line">for( auto iter = arr.begin(); iter != arr.end(); ++iter )  </div><div class="line">    cout &lt;&lt; *iter &lt;&lt; &quot; &quot;;  </div><div class="line">cout &lt;&lt; endl;</div></pre></td></tr></table></figure></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://book.douban.com/subject/10440485/" target="_blank" rel="external">The C++ Standard Library Second Edition</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/19/链表/" itemprop="url">
                  数据结构（一）-- 链表的实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-09-19T20:01:10+08:00" content="2014-09-19">
              2014-09-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="单向链表"><a href="#单向链表" class="headerlink" title="单向链表"></a>单向链表</h2><p>　　实现一个单向链表，提供以下操作：</p>
<ul>
<li><code>push_front()</code>从链表头部插入元素，<code>O(1)</code>操作。</li>
<li><code>remove()</code>删除指定元素，<code>O(N)</code>操作。</li>
<li><code>reverse()</code>反转链表，<code>O(N)</code>操作。</li>
<li><code>clear()</code>删除链表，<code>O(N)</code>操作。
　<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _LINKEDLIST_H_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _LINKEDLIST_H_</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> LinkedList</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">using</span> size_type = <span class="built_in">std</span>::<span class="keyword">size_t</span>;</div><div class="line">    </div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">struct</span> node</div><div class="line">    &#123;</div><div class="line">        node( <span class="keyword">const</span> T &amp;v, node *n = <span class="literal">nullptr</span> )</div><div class="line">            : value( v ), next( n )</div><div class="line">        &#123;   </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        T        value;</div><div class="line">        node     *next;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    node       *head_   = <span class="literal">nullptr</span>;</div><div class="line">    size_type  size_    = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">LinkedList</span><span class="params">()</span> </span>= <span class="keyword">default</span>;</div><div class="line">    </div><div class="line">    LinkedList( <span class="keyword">const</span> LinkedList &amp; ) = <span class="keyword">delete</span>;</div><div class="line">    LinkedList &amp;<span class="keyword">operator</span>=( <span class="keyword">const</span> LinkedList &amp; ) = <span class="keyword">delete</span>;</div><div class="line"></div><div class="line">    ~LinkedList()</div><div class="line">    &#123;</div><div class="line">        clear();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        node *next = <span class="literal">nullptr</span>;</div><div class="line">        <span class="keyword">for</span>( <span class="keyword">auto</span> curr = head_; curr != <span class="literal">nullptr</span>; curr = curr-&gt;next )</div><div class="line">        &#123;</div><div class="line">            next = head_-&gt;next;</div><div class="line">            <span class="keyword">delete</span> curr;</div><div class="line">        &#125;</div><div class="line">        head_ = <span class="literal">nullptr</span>;</div><div class="line">        size_ = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_front</span><span class="params">( <span class="keyword">const</span> T &amp;elem )</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">auto</span> ptr = <span class="keyword">new</span> node( elem, head_ );</div><div class="line">        head_ = ptr;</div><div class="line">        ++<span class="keyword">size_t</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="keyword">const</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> size_ == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function">size_type <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> size_;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">( <span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;delim = <span class="string">" "</span> )</span> <span class="keyword">const</span> </span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">for</span>( <span class="keyword">auto</span> iter = head_; iter != <span class="literal">nullptr</span>; iter = iter-&gt;next )</div><div class="line">        &#123;</div><div class="line">            os &lt;&lt; iter-&gt;value &lt;&lt; delim;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        node *prev = <span class="literal">nullptr</span>;</div><div class="line"></div><div class="line">        <span class="keyword">while</span>( head_ )</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">auto</span> next = head_-&gt;next;</div><div class="line">            head_-&gt;next = prev;</div><div class="line">            prev = head_;</div><div class="line">            head_ = next;</div><div class="line">        &#125;</div><div class="line">        head_ = prev;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">( <span class="keyword">const</span> T &amp;elem )</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">while</span>( head_ &amp;&amp; head_-&gt;value == elem )</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">auto</span> next = head_-&gt;next;</div><div class="line">            <span class="keyword">delete</span> head_;</div><div class="line">            head_ = next;</div><div class="line">            --size_;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>( !head_ )</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">auto</span> prev = head_;</div><div class="line">        <span class="keyword">auto</span> curr = head_-&gt;next;</div><div class="line">        <span class="keyword">while</span>( curr )</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">auto</span> next = curr-&gt;next;</div><div class="line">            <span class="keyword">if</span>( curr-&gt;value == elem )</div><div class="line">            &#123;</div><div class="line">                prev-&gt;next = next;</div><div class="line">                <span class="keyword">delete</span> curr;</div><div class="line">                --size_;</div><div class="line">            &#125; </div><div class="line">            <span class="keyword">else</span> </div><div class="line">            &#123;</div><div class="line">                prev = curr;</div><div class="line">            &#125;</div><div class="line">            curr = next;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span>&lt;&lt;( <span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> LinkedList&lt;T&gt; &amp;lst )</div><div class="line">&#123;</div><div class="line">    lst.print( os );</div><div class="line">    <span class="keyword">return</span> os;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* _LINKEDLIST_H_ */</span></span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://www.amazon.com/Algorithms-Parts-1-4-Fundamentals-Structure/dp/0201350882" target="_blank" rel="external">Algorithms in C++ 3rd Edition by Robert Sedgewick</a></li>
<li><a href="http://www.amazon.com/Data-Structures-Algorithm-Analysis-C/dp/013284737X/ref=sr_1_4?s=books&amp;ie=UTF8&amp;qid=1422255950&amp;sr=1-4&amp;keywords=data+structure+and+algorithm+in+c%2B%2B" target="_blank" rel="external">Data Structures and Algorithm Analysis in C++ 4th Edition by Mark A. Weiss</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="John Doe" />
          <p class="site-author-name" itemprop="name">John Doe</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">97</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
